import{r as t,h as i,H as e}from"./p-ddbb1df8.js";import"./p-bec3b19e.js";import"./p-58d13c5e.js";import"./p-f3a0c163.js";import{l as s}from"./p-d5d1c985.js";import{s as o}from"./p-38942298.js";const a=class{constructor(i){t(this,i),this.variableOptions=["room_type","borough","neighborhood","reviews","overall","satisfaction","accommodates"]}async connectedCallback(){this.SQL=await o({locateFile:t=>"./assets/sql.js/"+t})}render(){var t;return i(e,null,i("ion-header",null,i("ion-toolbar",{color:"primary"},i("ion-title",null,"Weather Vis"," - "+((null===(t=this.file)||void 0===t?void 0:t.name)||"No File Opened")),i("ion-buttons",{slot:"start"},i("ion-back-button",{defaultHref:"/"})),i("ion-buttons",{slot:"end"},i("ion-button",{title:"Open",onClick:()=>this.fileInputElement.click()},i("ion-icon",{slot:"icon-only",name:"open"}))))),i("ion-content",{class:"ion-padding"},i("ion-item",{disabled:!this.file},i("ion-label",null,"Variables"),i("ion-select",{multiple:!0,onIonChange:async({detail:t})=>{this.selectedVariables=t.value,this.updateData()}},this.variableOptions.map(t=>i("ion-select-option",null,t)))),i("s-set-vis",{ref:t=>this.setVisElement=t,"parallel-sets-ribbon-tension":.5,parallelSetsDimensions:[""]}),i("iframe",{width:"500",height:"500",style:{border:"0"},ref:async t=>{this.mapIframeElement=t;const i=await(await fetch("./assets/map.html")).text();t.contentDocument.querySelector("div#map")||(t.contentDocument.open(),t.contentDocument.write(i),t.contentDocument.close(),window.addEventListener("message",({data:i})=>{switch(i.type){case"hello":t.contentWindow.postMessage({type:"view center point",info:{location:[51.045868,-114.061627],zoom:10}},"*");break;case"select rect":this.updateData(i.info)}}))}}),i("ion-button",{onClick:()=>this.mapIframeElement.contentWindow.postMessage({type:"reset range selection"},"*")},"Remove Range Selection")),i("input",{id:"file-input",type:"file",ref:t=>this.fileInputElement=t,onInput:async({target:t})=>{var i;this.file=null===(i=t.files)||void 0===i?void 0:i[0];const e=await s.create({message:`Opening ${this.file.name}...`});await e.present();const o=await this.file.arrayBuffer();this.DB=new this.SQL.Database(new Uint8Array(o)),await e.dismiss()}}))}async updateData(t){const i=await this.queryData(t);i&&(this.mapIframeElement.contentWindow.postMessage({type:"add pins",info:i.sort((t,i)=>i.overall_satisfaction-t.overall_satisfaction).slice(0,100).map(t=>[t.latitude,t.longitude])},"*"),this.setVisElement.data=i,this.setVisElement.parallelSetsDimensions=["room_type","borough","neighborhood"],this.setVisElement.statisticsPlotGroupDefinitions=["overall_satisfaction","price"].map(t=>({dimensionName:t,visType:"box"})))}async queryData(t){var i;let e=[],s="select room_type, borough, neighborhood, overall_satisfaction, price, latitude, longitude from arbnb where substr(last_modified, 0, 11) = '2016-08-22'";t&&(s+=`and latitude >= ${t.minLat} and latitude <= ${t.maxLat} and longitude >= ${t.minLon} and longitude <= ${t.maxLon}`);const o=null===(i=this.DB.exec(s))||void 0===i?void 0:i[0];return e=null==o?void 0:o.values.map(t=>{const i={};for(let e=0;e<t.length;e++)switch(o.columns[e]){case"overall_satisfaction":case"price":i[o.columns[e]]=isNaN(+t[e])?0:+t[e];break;default:i[o.columns[e]]=t[e]}return i}),e}};a.style=".sc-app-airbnb-vis-h{display:block}#file-input.sc-app-airbnb-vis{display:none}s-set-vis.sc-app-airbnb-vis{height:600px;widows:100%}";export{a as app_airbnb_vis}